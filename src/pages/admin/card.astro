---
import Layout from "@/layouts/Layout.astro";
import CardDesigner from "@components/CardDesigner";
import { clubMappings } from "@data/clubFair";
import { getCollection } from "astro:content";
import { SITE } from "@data/constants";

export const prerender = false;
const currentClubCode = Astro.url.searchParams.get("clubCode") || "A08"; 

const allClubs = await getCollection("clubs");
const clubContent = allClubs.find((club) =>
  club.slug.startsWith(currentClubCode.toLowerCase())
);
const clubMapInfo = clubMappings[currentClubCode];

let componentProps = null;
if (clubContent && clubMapInfo) {
  componentProps = {
    clubName: clubContent.data.name,
    clubCode: currentClubCode,
    stampId: clubMapInfo.stampId,
    summary: clubContent.data.summary,
    mapId: clubMapInfo.mapId,
    shareUrl: `${SITE.url}/clubs/${clubContent.slug}`,
  };
}

---

<Layout title="卡片設計工作台">
  <main
    class="flex-1 flex flex-col items-center justify-center p-8 bg-gray-200 overflow-hidden"
  >
    <h2 class="text-2xl font-semibold mb-4 text-gray-800">互動式預覽</h2>
    {
      componentProps ? (
        <CardDesigner client:load {...componentProps} />
      ) : (
        <p class="text-red-500">找不到社團資料: {currentClubCode}</p>
      )
    }
  </main>
</Layout>
